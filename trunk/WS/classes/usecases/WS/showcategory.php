<?	class UCShowCategory extends UseCase 	{		function defaultAction($p)		{		        global $db;										$s = $this->eachPage();			if(isset($_GET['id']) && is_numeric($_GET['id'])) {				$id = $_GET['id'];				$res = $db->query("SELECT * FROM categories WHERE enable='1' ORDER BY i_base, pos");							foreach($res as $r) {					if($r['id_categories'] == $id) {						$s .= "<topcategory>";						$s .= $this->xmlize($r);						$s .= $this->resQuery("SELECT * FROM products WHERE category = '$r[id_categories]' ORDER  BY title", "productlist", "item");									$s .= $this->catIter($id, 1, $res);						$s .= "</topcategory>";					}				}			} else {				$s .= "<relocate><url>?usecase=Start</url></relocate>";			}			$p->add("<document>".$s."</document>");			return $p;		}		function catIter($base, $k, $res) 		{		 	if($k > 100) return "";		 				$s = "";			foreach($res as $r) {				if($r['i_base'] == $base) {					$s .= "<category>";					$s .= $this->xmlize($r);					$s .= $this->resQuery("SELECT * FROM products WHERE category = '$r[id_categories]' ORDER  BY title", "productlist", "item");								$s .= $this->catIter($r['id_categories'], $k + 1, $res);					$s .= "</category>";				}			}			return $s;		}	}?>