<?	class UCSearchProduct extends UseCase 	{		function defaultAction($p)		{		        global $db;										$s = $this->eachPage();			$q = rawurldecode($_GET['f_q']);			if(strlen($q) > 2) {				$begin = (isset($_GET['begin']) && is_numeric($_GET['begin'])) ? $_GET['begin'] : 0;				$npp = 8;	        	$src = "QWERTYUIOPASDFGHJKLZXCVBNMЁЙЦУКЕНГШЩЗХЪФЫВАПРОЛДЖЭЯЧСМИТЬБЮ,./';[]`~|_=+{}?<>!@#$%^&*()�:";				$dst = "qwertyuiopasdfghjklzxcvbnmёйцукенгшщзхъфывапролджэячсмитьбю                              ";						$tr = strtr($_GET['f_q'], $src, $dst);							$qe = rawurlencode($tr);				$k = explode(' ', $tr);						$rule = array();				foreach($k as $it) {					if(strlen($it) > 1) {						array_push($rule,"LCASE(id_products) LIKE '%$it%'");							array_push($rule,"LCASE(title) LIKE '%$it%'");							array_push($rule,"LCASE(shortinfo) LIKE '%$it%'");							array_push($rule,"LCASE(info) LIKE '%$it%'");						};				};				$ss = implode(" or ",$rule);										$res = $db->query("SELECT COUNT(id_products) FROM products WHERE $ss");				$total = $res[0]['COUNT(id_products)'];				$s .= "<search>";				$s .= "<query>$tr</query>";				$s .= "<total>$total</total>";									$s .= $this->resQuery("SELECT * FROM products WHERE $ss ORDER  BY c_price DESC LIMIT $begin,$npp", "productlist", "item");							$s .= $this->pager($total, $begin, $npp, 10, 'index.php?usecase=SearchProduct&amp;f_q='.$qe);				$s .= "</search>";			} else {				$s .= $this->getDocument('short_search_request');			}			$p->add("<document>".$s."</document>");			return $p;		}	}?>