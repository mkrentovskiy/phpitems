<?	class UCShowRequests extends UseCase 	{		function action($p)		{		        global $db;										$s = $this->eachPage();			$begin = $this->checkValue($_GET, 'begin',  0, 3600, 'requests');			$filter = $this->checkValue($_GET, 'filter',  0, 3600, 'requests');			$s .= $this->resQuery("SELECT * FROM request_states ORDER BY pos", "states", "item");						$npp = 7;						$ss = "user='".$this->user->getId()."'";			if($filter > 0) {				$ss .= " AND state='$filter'";					$s .= "<currentstate>$filter</currentstate>";			}			$res = $db->query("SELECT COUNT(id_requests) FROM requests WHERE $ss");			$total = $res[0]['COUNT(id_requests)'];			$s .= "<requestlist>";								$res = $db->query("SELECT *, DATE_FORMAT(tmark,'%e.%m.%Y') AS tm  FROM requests WHERE $ss ORDER BY tmark DESC LIMIT $begin,$npp");						foreach($res as $r) {				$s .= "<requestitem>";				$s .= $this->xmlize($r);				$s .= $this->resQuery("SELECT * FROM request_items WHERE request='$r[id_requests]' ORDER BY num DESC", "content", "item");											$s .= "</requestitem>";			}						$s .= $this->pager($total, $begin, $npp, 10, '?usecase=ShowRequests');			$s .= "</requestlist>";			$p->add("<document>".$s."</document>");			return $p;		}		function defaultAction($p)		{				$s = $this->eachPage();			$s .= $this->getDocument("access_denited");			$p->add("<document>".$s."</document>");			return $p;		}	}?>